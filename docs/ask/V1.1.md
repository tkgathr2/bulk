# 一括検索君：要件定義（Ask）V1.1（100点・第1回改善）

## 現在のフェーズ / 進捗

- フェーズ：Ask（要件定義）
- 進捗：30%（100点版（第1回改善）を作成した段階のため）

---

## 1. プロジェクト概要

### 1-1. 目的

総務部門を起点に、会社全体の従業員が **Slack / Dropbox / Gmail / Google ドライブ** を **1つの検索窓** から横断的に検索できる **Webアプリ**（PCブラウザ優先）を構築する。

### 1-2. 背景

- 総務がデータを探す際、複数サービスを個別に開いて検索する必要がある
- サービスごとに検索UIが異なり、作業効率が悪い
- 「どのサービスに保存したか分からない」ケースが頻発する

### 1-3. 対象ユーザー

- 会社全体の従業員（総務部門が主たるヘビーユーザー）
- 想定同時利用者数：最大50人程度（会社規模により変動）

### 1-4. プラットフォーム

- Webアプリ（ブラウザベース）
- PCブラウザ優先（Chrome / Edge）
- モバイル対応：MVP対象外（次段階で検討）

### 1-5. デプロイ先

- クラウド（社内の誰でもブラウザからアクセス可能）
- 具体的なクラウドサービスは Plan フェーズで確定

---

## 2. MVP機能一覧（第1段階）

### 2-1. 横断検索機能

| 項目 | 内容 |
|------|------|
| アプリ名 | 一括検索君 |
| 検索対象サービス | Slack / Dropbox / Gmail / Google ドライブ |
| 検索方式 | キーワード検索（全文）+ ファイル名検索 |
| 検索実行方式 | 各サービスAPIへ並列で同時リクエスト |
| 結果の統合表示 | サービス別タブで分類表示。タブ切り替えで閲覧 |
| 結果のソート | 関連度順（デフォルト）/ 日付順（新しい順・古い順） |
| ページネーション | 各サービスタブ内で20件ずつ表示、「もっと見る」で追加読み込み |
| 検索結果の合計件数 | 各タブにヒット件数をバッジ表示 |

### 2-2. ファイル内部検索（コンテンツ検索）

| 対象 | 検索範囲 |
|------|----------|
| Gmail | メール件名 + メール本文 + 添付ファイル名 |
| Slack | メッセージ本文（パブリックチャンネルのみ。DM・プライベートチャンネルはMVP対象外） |
| Dropbox | ファイル名 + ファイル内テキスト（Dropbox APIのコンテンツ検索機能を利用） |
| Google ドライブ | ファイル名 + ファイル内テキスト（Google Drive APIの全文検索機能を利用） |

**ファイル内検索の対応フォーマット**（各API機能に依存）：

- PDF
- Microsoft Word（.doc / .docx）
- Microsoft Excel（.xls / .xlsx）
- Microsoft PowerPoint（.ppt / .pptx）
- Google ドキュメント / スプレッドシート / スライド
- プレーンテキスト（.txt / .csv）

※ APIが対応していないフォーマットの場合はファイル名のみの検索となる

### 2-3. 検索フィルタ機能

| フィルタ | 内容 |
|----------|------|
| サービス絞り込み | チェックボックスで検索対象サービスを選択（デフォルト全選択） |
| 日付範囲 | 開始日〜終了日の指定（任意） |
| ファイル種別 | ドキュメント / スプレッドシート / PDF / 画像 / その他（任意） |

### 2-4. 検索結果プレビュー

| 項目 | 内容 |
|------|------|
| 一覧表示 | タイトル/ファイル名、サービスアイコン、更新日、スニペット（該当箇所の抜粋） |
| 詳細プレビュー | 検索結果クリック時にサイドパネルで概要表示 |
| 外部リンク | 「元のサービスで開く」ボタンで元ページへ遷移 |

### 2-5. 認証・サービス連携

| 項目 | 内容 |
|------|------|
| ログイン方式 | Google OAuth 2.0（Google Workspace アカウント利用） |
| Slack 連携 | Slack OAuth 2.0（Slack App としてワークスペースにインストール） |
| Dropbox 連携 | Dropbox OAuth 2.0 |
| Google系連携 | Google OAuth のスコープに Gmail + Drive を含める |
| 連携管理画面 | 各サービスの接続状態表示、接続/切断ボタン |

### 2-6. 検索履歴機能

| 項目 | 内容 |
|------|------|
| 保存対象 | 直近の検索キーワード（最大30件） |
| 表示場所 | 検索バーフォーカス時にドロップダウンで表示 |
| 削除 | 個別削除 / 全削除 |

### 2-7. 管理者機能（MVP最小限）

| 項目 | 内容 |
|------|------|
| ユーザー管理 | Google Workspace のアカウントに連動（個別のユーザー管理はMVP対象外） |
| 管理者ロール | MVPでは管理者/一般ユーザーの区別なし（全員同一権限） |

---

## 3. 権限・セキュリティ

| 項目 | 内容 |
|------|------|
| データアクセス範囲 | 各ユーザーが自身のアカウントで認可した範囲のみ検索可能 |
| 他人のデータ閲覧 | 不可（各自のOAuthトークンで検索するため） |
| トークン保存 | サーバーサイドで暗号化保存 |
| 通信 | HTTPS必須 |
| セッション管理 | JWT方式、有効期限あり |

---

## 4. エラーハンドリング

| ケース | 対応 |
|--------|------|
| 特定サービスのAPI接続失敗 | 該当タブにエラー表示。他サービスの検索は継続 |
| OAuthトークン期限切れ | 再認証を促す。設定画面への導線 |
| APIレートリミット到達 | 「しばらく待ってから再検索してください」表示 |
| 検索結果0件 | 0件表示 + 条件見直し提案 |
| ネットワークエラー | リトライボタン付きのエラー表示 |

---

## 5. 画面一覧と主要UI要素（モック準拠）

| 画面名 | 主要UI要素 |
|--------|------------|
| ログイン画面 | ロゴ、「Googleアカウントでログイン」ボタン |
| 検索トップ画面 | 検索バー、サービス絞り込み、日付フィルタ、検索履歴ドロップダウン |
| 検索結果一覧画面 | サービス別タブ（件数バッジ）、結果リスト（スニペット）、ソート、「もっと見る」、サイドプレビューパネル |
| 検索結果詳細画面 | メタ情報、本文プレビュー、「元サービスで開く」 |
| サービス連携設定画面 | 接続状態、接続/切断ボタン、注意文（権限範囲） |

画面遷移図は `docs/screen_flow.md` を唯一の参照とする。

---

## 6. 非機能要件（具体数値）

| 項目 | 目標値 |
|------|--------|
| 検索レスポンス | 各サービスから3秒以内に初回結果返却（ネットワーク状況による） |
| 同時接続ユーザー | 最大50人 |
| 可用性 | 99%（月間ダウンタイム約7時間以内） |
| ブラウザ対応 | Chrome最新版 / Edge最新版 |
| データ保持 | 検索履歴のみ保存。検索結果キャッシュは行わない（常に最新をAPI取得） |

---

## 7. 次段階の拡張候補（MVP対象外）

| 段階 | 機能 |
|------|------|
| 第2段階 | スプレッドシートのセル内容検索 |
| 第2段階 | Slack DM・プライベートチャンネル検索 |
| 第2段階 | モバイル対応（レスポンシブ） |
| 第3段階 | ブックマーク/お気に入り |
| 第3段階 | 管理者機能拡充（利用ログ、ユーザー管理） |
| 第3段階 | 追加サービス連携（Notion、Teams等） |

---

## 8. 制約事項・前提条件

| 項目 | 内容 |
|------|------|
| Google Workspace | 会社が利用している前提 |
| Slack | 会社が利用している前提 |
| Dropbox | 会社が Dropbox Business を利用している前提 |
| API利用料 | 会社負担（無料枠内に収まるか要確認） |
| 開発範囲 | 閲覧・検索のみ。編集・削除機能は持たない |

---

## 9. NG例（やってはいけないこと）

- ユーザーAがユーザーBのプライベートなメール/ファイルを検索・閲覧できてしまう
- APIキーやOAuthトークンがブラウザの開発者ツールから見える
- 1つのサービス障害で他サービス検索まで止まる
- 検索結果をサーバーにキャッシュし、古い情報が表示され続ける
- ファイルの中身をサーバーにダウンロード・保存する（プレビューはAPI経由のみ）

