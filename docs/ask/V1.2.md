# 一括検索君：要件定義（Ask）V1.2（最終100点・第2回改善）

## 現在のフェーズ / 進捗

- フェーズ：Ask（要件定義）
- 進捗：40%（Ask最終案を作成し、最終承認待ちの段階のため）

---

## 0. この文書の位置づけ（唯一のAsk成果物）

- 本書（`docs/ask/V1.2.md`）を Ask フェーズの **最終100点版** とする
- UIイメージは `mockups/` を参照（実装仕様ではなく合意形成用）
- 画面遷移図は `docs/screen_flow.md` を参照

---

## 1. 目的 / 成果

### 1-1. 目的

会社内の業務情報が複数サービスに分散している状況で、従業員が「探す」時間を最小化するため、**1つの検索窓**で横断検索できるツール **「一括検索君」** を提供する。

### 1-2. 成果（達成したい状態）

- ユーザーが「どこにあるか分からない」情報を、まず一括検索で当たりを付けられる
- サービスを横断した検索結果が、統一UIで比較・プレビューできる
- 元サービスへのリンクで、最終的な確認・共有に移れる

---

## 2. スコープ

### 2-1. MVP（第1段階）対象サービス

- Slack
- Gmail
- Dropbox
- Google ドライブ

### 2-2. MVP対象外（第2段階以降）

- Google スプレッドシート「セル内容」検索（第2段階）
- Slack DM / プライベートチャンネル検索（第2段階）
- モバイル最適化（第2段階）
- お気に入り、管理者ログ、追加サービス（第3段階）

---

## 3. ユーザー / ロール / 権限

### 3-1. 対象ユーザー

- 会社全体の従業員（総務がヘビーユーザー）

### 3-2. ロール（MVP）

- ロール区別なし（全員同一権限）
- ユーザー管理は Google Workspace アカウントに連動（アプリ独自のユーザー台帳は持たない）

### 3-3. 権限の原則（最重要）

**原則：各ユーザーがアクセス権を持つデータのみ検索・閲覧できる。**

- Slack / Gmail / Dropbox / Drive は、各ユーザーのOAuth認可範囲に限定
- 他人のデータの横断閲覧は不可
- 例外として、会社ポリシーにより「管理者が監査目的で組織全体を検索する」要件がある場合は、MVP範囲外として別途要件化する（本MVPでは扱わない）

---

## 4. 検索機能（MVP）

### 4-1. 検索方式

- キーワード検索（全文）
- ファイル名検索

### 4-2. 検索対象（コンテンツ内部）

ユーザー要望として、以下の「中身」を検索対象に含める。

- Slack：メッセージ本文（MVPはパブリックチャンネルのみ）
- Gmail：件名＋本文＋添付ファイル名
- Dropbox：ファイル名＋ファイル内テキスト（APIが対応する範囲）
- Google ドライブ：ファイル名＋ファイル内テキスト（APIが対応する範囲）

### 4-3. ファイル内検索の対象フォーマット

以下を「対象とする」ただし実際の可否は各API依存で、未対応の場合は **ファイル名検索のみ** にフォールバックする。

- PDF
- Word / Excel / PowerPoint（.doc/.docx/.xls/.xlsx/.ppt/.pptx）
- Google ドキュメント / スプレッドシート / スライド（※セル内容検索は第2段階）
- テキスト（.txt/.csv）

### 4-4. 検索実行方式（UX要件）

- 各サービスAPIへ **並列で同時リクエスト**
- 1サービスが失敗しても、他サービスの検索は継続する
- 各タブに成功/失敗/件数が分かる表示をする

### 4-5. フィルタ

- サービス絞り込み（デフォルト全選択）
- 日付範囲（任意）
- ファイル種別（任意）

### 4-6. ソート

- 関連度順（デフォルト）
- 日付順（新しい順 / 古い順）

### 4-7. ページング

- サービス別タブ内で 20件単位で追加読み込み（「もっと見る」）

---

## 5. 画面要件（MVP）

### 5-1. 画面一覧

- ログイン
- 検索トップ
- 検索結果一覧
- 検索結果詳細
- サービス連携設定

### 5-2. UI方針

- デザインは **Google（Workspace系）寄せ**
- 画面モック：`mockups/`（V0.2）
- スクリーンショット：`mockups/screenshots/`

### 5-3. 検索結果一覧レイアウト（確定）

- 左：結果リスト
- 右：サイドプレビュー（選択中の結果の要約）

---

## 6. 認証 / 連携（MVP）

### 6-1. 認証

- Google OAuth 2.0（Google Workspace アカウント）

### 6-2. 連携

- Slack OAuth 2.0（Slack Appとしてインストール）
- Dropbox OAuth 2.0
- Google（Gmail + Drive）を同一のGoogle OAuthスコープで連携

---

## 7. データ保持 / プライバシー

### 7-1. 保存するもの（MVP）

- 検索履歴（直近30件、ユーザー単位）

### 7-2. 保存しないもの（MVP）

- 検索結果のサーバーキャッシュは行わない（常に最新をAPI取得）
- ファイル本文をサーバーへダウンロードして恒久保存しない（プレビューはAPI経由）

---

## 8. エラーハンドリング（MVP）

| ケース | 期待動作 |
|--------|----------|
| 特定サービスのAPI接続失敗 | 該当タブのみエラー表示。他タブは結果表示継続 |
| OAuthトークン期限切れ | 再認証導線を表示（設定画面へ誘導） |
| レートリミット | 待機の案内＋再実行を促す |
| 0件 | 0件表示＋条件見直しヒント |
| ネットワーク | リトライボタン |

---

## 9. 非機能要件（MVP）

| 項目 | 目標 |
|------|------|
| 検索初回応答 | 各サービスで3秒以内に初回結果（目安） |
| 同時利用 | 最大50人（目安） |
| ブラウザ | Chrome最新版 / Edge最新版 |
| 通信 | HTTPS必須 |
| トークン保管 | サーバー側で暗号化保存（実装方式はPlanで確定） |

---

## 10. NG例（受け入れ不可）

- ユーザーAがユーザーBのプライベートなメール/ファイルを検索・閲覧できる
- OAuthトークン等がブラウザ開発者ツールから取得できる
- 1サービス障害で全検索が停止する
- 古い検索結果がキャッシュで出続ける
- ファイル本文をサーバーに保存してしまう（MVPでは不可）

---

## 11. 例外ケース

- APIが未対応のファイル形式：ファイル名検索のみで結果を返す（「本文検索非対応」表示）
- Slack：MVPはパブリックのみ。DM/プライベートは「今後対応予定」と明示
- Drive：Googleスプレッドシートは、MVPでは「ファイルとしての検索（名前/メタ）」は可、セル内容検索は第2段階

---

## 12. Askフェーズ完了条件（本プロジェクトのゲート）

- [x] モック（HTML）確認済み（V0.2 / Google寄せ / 名称：一括検索君）
- [x] 画面遷移図確認済み（`docs/screen_flow.md`）
- [x] 要件定義が 60→100 を2回完了（V1.0→V1.1→V1.2）
- [ ] ユーザー最終承認（この文書にOK）

---

## 付録：Devinへ渡すタイミング（目安）

次の条件が揃ったら「本格的な開発」とみなし、Devin（実装担当）へ渡す。

- Ask（本書V1.2）が承認済み
- Plan（`docs/plan.md`）が承認済み（前提条件・受け入れ条件・NG例・例外ケース・データ定義・完了条件が揃っている）
- シークレット投入手順（SEC-01運用）がPlanに明記済み

